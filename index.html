<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fuel Efficiency</title>

    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style> .circle {fill: lightblue; stroke: black;} 
            .highlight {fill: yellow; stroke: black;} 
            .electricity {fill: green; stroke: black; opacity: 0.5;}
            .diesel {fill: red; stroke: black; opacity: 0.5;}
            .gasoline {fill: blue; stroke: black; opacity: 0.5;}
            .val {stroke: purple;}
            #tooltip {
                opacity: 0;
                position:  absolute;
                text-align: left;
                width: 150px; height: 60px;
                background: white;
                border: 0px;
            }
    </style>
</head>
<body onload='init()'>
<svg width=600 height=600 style="background-color:rgba(243, 250, 243, 0.986)">
</svg>
<div id="tooltip" opacity=0></div>
<script>
async function init() {

const data = await d3.csv("https://flunky.github.io/cars2017.csv");

// var margin = 50;
// X range
var x = d3.scaleLog().domain([10,150]).range([0,500]);
// Y range
var y = d3.scaleLog().domain([10,150]).range([500,0]);

var tooltip = d3.select("#tooltip");

var svg = d3.select("body")
            .select("svg");

var rightArrow = svg.append("g")
    .attr("transform", "translate(550,250) scale(0.5, 1.0)")
    .attr("class", "rightArrow")
    .append("a")
    .attr("xlink:href", "gasoline5.html")
    .append("path")
    .attr("d", "M 20 0 L 30 0 L 60 30 L 30 60 L20 60 L 50 30 Z")
    .attr("fill", "lightgrey")
    .attr("cursor", "pointer")
    .on("mouseover", function() {
        console.log("I was hovered over.");
        d3.select(this)
        .attr("fill", "orange");
    })
    .on("mouseout", function() {
        console.log("I was not hovered over.");
        d3.select(this)
        .attr("fill", "lightgrey");
    });

svg.append("g")
   .attr("transform", "translate(50,50)")
   .selectAll("circle")
   .data(data)
   .enter()
   .append("circle")
   .attr("class", (d) => {
        if (d.Fuel == 'Electricity') {
            return "electricity";
        } else if (d.Fuel == 'Diesel') {
            return "diesel";
        } else if (d.Fuel == 'Gasoline') {
            return "gasoline";
        } else {
            return "circle";
        }
    })
   .attr("cx", function (d) { return x(d.AverageCityMPG); } )
   .attr("cy", function (d) { return y(d.AverageHighwayMPG); } )
   .attr("r", function (d) { return +d.EngineCylinders+2; })
   .on("mouseover", mouseover)
   .on("mouseout", mouseout);

function mouseover(d, i) {
    d3.select(this)
        .attr("class", "highlight");

    tooltip.style("opacity", 1)
            .style("left", (d3.event.pageX)+"px")
            .style("top", (d3.event.pageY)+"px")
            .html("Make: " + d.Make + "<br/> Fuel: " + d.Fuel + "<br/> City mpg: " + d.AverageCityMPG);
}

function mouseout(d, i) {
    d3.select(this)
        .attr("class", (d) => {
            if (d.Fuel == 'Electricity') {
                return "electricity";
            } else if (d.Fuel == 'Diesel') {
                return "diesel";
            } else if (d.Fuel == 'Gasoline') {
                return "gasoline";
            } else {
                return "circle";
            }
        });
    
    tooltip.style("opacity", 0)
}

svg.append("g")
    .attr("transform", "translate(50,50)")
    .call(d3.axisLeft(y)
    .tickValues([10,20,50,100])  
    .tickFormat(d3.format("~s")));

svg.append("text")
    .attr("x", 450)
    .attr("y", 585)
    .attr("text-anchor", "end")
    .attr("stroke", "black")
    .text("Average City MPG")

svg.append("g")
    .attr("transform", "translate(50,550)")
    .call(d3.axisBottom(x)
    .tickValues([10,20,50,100])  
    .tickFormat(d3.format("~s")));

svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -150)
    .attr("y", 100)
    .attr("dy", "-5.1em")
    .attr("text-anchor", "end")
    .attr("stroke", "black")
    .text("Average Highway MPG");

svg.append("text")
    .attr("x", 220)
    .attr("y", 40)
    .attr("font-size", "24px")
    .attr("stroke", "black")
    .text("Fuel Efficiency");

var legend1 = svg.append("g")
    .attr("transform", "translate(60,80)")
    
legend1.append("rect")
    .attr("class", "gasoline")
    .attr("width", 10)
    .attr("height", 10)
   
legend1.append("a")
    .attr("xlink:href", "gasoline5.html")
    .append("text")
    .attr("x", 15)
    .attr("y", 11)
    .attr("dy", "-0.05em")
    .attr("cursor", "pointer")
    .text("Gasoline")
    .on("click", function() {
        console.log("I was clicked");
        d3.select(this)
        .attr("stroke", "black");
    });
    
var legend2 = svg.append("g")
.attr("transform", "translate(140,80)")

legend2.append("rect")
.attr("class", "diesel")
.attr("width", 10)
.attr("height", 10)

legend2.append("a")
.attr("xlink:href", "diesel2.html")
.append("text")
.attr("x", 15)
.attr("y", 11)
.attr("dy", "-0.05em")
.attr("cursor", "pointer")
.text("Diesel")
.on("click", function() {
    console.log("I was also clicked");
    console.log(data[1]);
    d3.select(this)
    .attr("stroke", "black");
});
   
var legend3 = svg.append("g")
    .attr("transform", "translate(220,80)")
    
legend3.append("rect")
    .attr("class", "electricity")
    .attr("width", 10)
    .attr("height", 10)
   
legend3.append("a")
    .attr("xlink:href", "electricity2.html")
    .append("text")
    .attr("x", 15)
    .attr("y", 11)
    .attr("dy", "-0.05em")
    .attr("cursor", "pointer")
    .text("Electricity")
    .on("click", function() {
        console.log("I was clicked, too");
        d3.select(this)
        .attr("stroke", "black");
    });

}

</script>
</body>
</html>